\section{Operations}

\subsection{Add}

\begin{schema}{GitAddOk}
  \Delta Repository \\
  file?: Tree \\
  path?: Tree \\
  response!: GitResponse
\where
  index' = treeWithFile~(index, path?, file?) \\
  head' = head \\
  workingCopy' = workingCopy \\
  branch' = branch \\
  tag' = tag \\
  parent' = parent \\
  response! = Ok
\end{schema}

\begin{schema}{GitAddCannotAdd}
  \Xi Repository \\
  file?: Tree \\
  path?: Tree \\
  response!: GitResponse
\where
  (index, path?, file?) \notin \dom treeWithFile \\
  response! = CannotAdd
\end{schema}

\begin{zed}
  GitAdd \defs GitAddOk \lor GitAddCannotAdd
\end{zed}

\subsection{Branch}

\begin{schema}{GitBranchOk}
	\Delta Repository \\
	name?: Name \\
	commit?: Commit \\
	response!: GitResponse
\where
	name? \notin \dom branch \\
	branch' = branch \cup \{name? \mapsto commit?\} \\
	head' = head \\
	index' = index \\
	workingCopy' = workingCopy \\
	tag' = tag \\
	parent' = parent \\
	response! = Ok
\end{schema}

\begin{schema}{GitBranchBranchAlreadyExists}
	\Xi Repository \\
	name?: Name \\
	commit?: Commit \\
	response!: GitResponse
\where
	name? \in \dom branch \\
  response! = BranchAlreadyExists
\end{schema}

\begin{zed}
	GitBranch \defs GitBranchOk \lor GitBranchBranchAlreadyExists
\end{zed}

\subsection{Tag}

\begin{schema}{GitTagOk}
	\Delta Repository \\
	name?: Name \\
	commit?: Commit \\
	response!: GitResponse
\where
	name? \notin \dom tag \\
	tag' = tag \cup \{name? \mapsto commit?\} \\
	head' = head \\
	index' = index \\
	workingCopy' = workingCopy \\
	branch' = branch \\
	parent' = parent \\
	response! = Ok
\end{schema}

\begin{schema}{GitTagTagAlreadyExists}
	\Xi Repository \\
	name?: Name \\
	commit?: Commit \\
	response!: GitResponse
\where
	name? \in \dom tag \\
  response! = TagAlreadyExists
\end{schema}

\begin{zed}
	GitTag \defs GitTagOk \lor GitTagTagAlreadyExists
\end{zed}

\subsection{Commit}

\begin{schema}{GitCommitOk}
	\Delta Repository \\
	author?: Author \\
	message?: Message \\
	response!: GitResponse
\where
	head.tree \neq index \\
	head'.author = author? \\
	head'.message = message? \\
	head'.tree = index \\
	parent' = parent \cup \{head' \mapsto \{head\} \} \\
	workingCopy' = index \\
	index' = index \\
	branch' = branch \\
	tag' = tag \\
	response! = Ok
\end{schema}

\begin{schema}{GitCommitNothingToCommit}
	\Xi Repository \\
	author?: Author \\
	message?: Message \\
	response!: GitResponse
\where
	head.tree = index \\
	response! = NothingToCommit
\end{schema}

\begin{zed}
	GitCommit \defs GitCommitOk \lor GitCommitNothingToCommit
\end{zed}

\subsection{Reset Hard}

\begin{schema}{GitResetHardOk}
  \Delta Repository \\
  commit?: Commit \\
  response!: GitResponse \\
  refs: \finset Commit
\where
  refs = \{ head \} \cup \ran branch \cup \ran tag \\
  \exists r: refs \spot commit? \in recursiveParents~(r,parent) \\
  head' = commit? \\
  index' = workingCopy' = commit?.tree \\
  branch' = branch \\
  tag' = tag \\
  parent' = parent \\
  response! = Ok
\end{schema}

\begin{schema}{GitResetHardCommitNotInRepository}
  \Xi Repository \\
  commit?: Commit \\
  response!: GitResponse \\
  refs: \finset Commit
\where
  refs = \{ head \} \cup \ran branch \cup \ran tag \\
  \lnot (\exists r: refs \spot commit? \in recursiveParents~(r,parent)) \\
  response! = CommitNotInRepository
\end{schema}

\begin{zed}
  GitResetHard \defs GitResetHardOk \lor GitResetHardCommitNotInRepository
\end{zed}

% reset soft
% reset mixed
% checkout branch
% cherry pick

% trabajo futuro:
% garbage collector
% definir merge conflict
% merge -> tiempo
% rebase -> tiempo
% add -> sin delete, sin update
% operaciones con remotes (fetch, pull, push, ...)

