\section{Schemas}

\begin{schema}{FileMode}
  user: FilePermission \\
  group: FilePermission \\
  owner: FilePermission
\end{schema}

\begin{schema}{Object}
  mode: FileMode \\
	filename: Name
\end{schema}

\begin{zed}
  Tree ::= treeBlob \ldata Object \rdata | treeBranch \ldata Object \cross \finset Tree \rdata
\end{zed}

\begin{schema}{Commit}
	author: Author \\
	message: Message \\
	tree: Tree
\end{schema}

\begin{axdef}
  subTrees: Tree \pfun \finset Tree
\where
  \exists a,b,c: Tree; bo: Object; bc: \finset Tree \spot a \in subTrees~b \iff \\
  \t1 a = b \lor \\
  \t1 b \in \ran treeBranch \land b = treeBranch~(bo,bc) \land c \in bc \land a \in subTrees~c
\end{axdef}

\begin{axdef}
  treeWithFile: Tree \cross Tree \cross Tree \pfun Tree
\where
  \exists src, path, file, new, c: Tree; so: Object; sc, sc': \finset Tree \spot new = treeWithFile~(src, path, file) \iff \\
  \t1 src = treeBranch~(so,sc) \land \\
  \t1 path \in \ran treeBranch \land \\
  \t1 path \in subTrees~src \land \\
    \t2 ( src = path \land new = treeBranch~(so, sc \cup \{ file \}) \lor \\
    \t2 sc' = \{ c: sc | path \notin subTrees~c \} \cup \\
      \t3 \{ t: Tree | c \in sc \land path \in subTrees~c \land t = treeWithFile~(c, path, file) \} \land \\
      \t3 new = treeBranch~(so, sc') )
\end{axdef}

\begin{axdef}
  hashTree: Tree \surj Digest
\end{axdef}

\begin{axdef}
  hashCommit: Commit \surj Digest
\end{axdef}
